php oil refine migrate:up --packages=kontiki
delete from migration where 1 = 1;

//現在のコントローラ
'\\'.\Request::main()->controller
$controller = \Inflector::denamespace(\Request::main()->controller);
$controller = strtolower(substr($controller, 11));

//現在のアクション
$this->request->action

＊　＊　＊

scaffoldをつくっちゃう。

適当なコントローラを作って、soft delete非対応時の処理を書く
あと、purge依存しないようにしちゃうか。

＊　＊　＊

存在するコンテンツの時限装置の考案

■承認管理システム（いわゆるワークフロー）の実装相談
abstract controllerに
$this->is_workflowed
を設定。trueだったら、項目をワークフロー管理する
ワークフロー管理するコントローラには
- statusフィールド
- workflow_route_idフィールド
- workflow_routeフィールド
必須とする。
$this->is_workflowed = true
なのに、このフィールドがないときにはエラーを出す

$this->is_workflowed = true
のコントローラは、フォームにstatusを変更できるスイッチがあったとしても、すべて無効になる。つまり編集者／承認者は項目の可視属性等をまったく変更できない。
statusはworkflowedかpublicのいずれかしか存在しない。

workflowコントローラを作る
workflowコントローラでは、経路設定ができる
最初に、承認ステップ数を決定する（ステップ数は最低2。1の場合は、自動的に承認される）

              OR or AND
+-------+    +-------+
+creator+ -> +user1  +
+       +    +group1 +
+       +    +user2  +
+-------+    +-------+

workflow_routeフィールドはこうなる。
array(
	//最初の配列は、申請済みなら1が入る。そうでなければ0
	array(1),
	//以降の配列は属性と承認者情報が入る
	array(
		'type' => 'OR',
		'users' => array(
			1 => 'YYYY-MM-DD',
		),
		'usergroups' => array(),
	),
	array(
		'type' => 'AND',
		'users' => array(
			1 => 'YYYY-MM-DD',
			3 => 'YYYY-MM-DD',
		),
		'usergroups' => array(
			3 => 'YYYY-MM-DD',
		),
	),
)
