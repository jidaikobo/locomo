php oil refine migrate:current --packages=kontiki
php oil refine migrate:up --packages=kontiki
delete from migration where 1 = 1;

//現在のコントローラ
'\\'.\Request::main()->controller
$controller = \Inflector::denamespace(\Request::main()->controller);
$controller = strtolower(substr($controller, 11));

//現在のアクション
$this->request->action

＊　＊　＊

coreディレクトリを作る？

destroyをいつか作る

＊　＊　＊

存在するコンテンツの時限装置の考案

■承認管理システム（いわゆるワークフロー）の実装相談


workflow_actionsのアクションセットが有効なコントローラでは、
項目をワークフロー管理する
ワークフロー管理するコントローラには
- workflow_statusフィールド
必須とする。
workflow_actionsがあるのに、
なのに、このフィールドがないときにはエラーを出す

対象のコントローラは、フォームにstatusを変更できるスイッチがあったとしても、すべて無効になる。つまり編集者／承認者は項目の可視属性等をまったく変更できない。
workflow_statusはin_progressかfinishedのいずれかしか存在しない。

workflow管理下のコントローラでは、特殊なACLになる。
- ゲスト（一般公開。すべて承認されたコンテンツ。statusはpublic）
- 作成者（非公開。statusはworkflowed）
- 承認者（非公開。statusはworkflowed）
編集中はeditingとか？


workflowコントローラを作る
workflowコントローラでは、経路設定ができる
最初に、承認ステップ数を決定する（ステップ数は最低2。1の場合は、自動的に承認される）

*workflows
id
name [XXセンター]

*workflow_steps
id
name [室長|事務局|事務局長....]
workflow_id
condition [and|or|atlease]
order

*workflow_step_actions
id
step_id
action [array(mail)]

*workflow_allowers
step_id
user_id

*workflow_logs
id
workflow_id
controller
controller_id
current_step
status	[default|apply|approve|reject|remand|finish]
comment
created_at
creator_id

却下はゴミ箱
差し戻し先は選べる。
柴田が推敲を経て（-/2）、申請する（0/2）
有松承認（1/2）、石田が有松に差し戻すと、柴田が申請した段階（0/2）になる。
有松、石田が柴田に差し戻すと、申請前（-/2）の状態になり、編集可能になる。
申請された項目は編集できない。
編集可能状態（-/2）は、ワークフロー経路の変更もできる。

ワークフロー管理されたコントローラでは、（-/N）のコンテンツ（申請前）の一覧
ワークフロー管理されたコントローラでは、（n/N）のコンテンツ（承認進行中）の一覧
ワークフロー管理されたコントローラでは、（n/N）のコンテンツ（自分が承認すべき項目）の一覧

をみられる
